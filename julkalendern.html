<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "https://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html lang="tlh" xmlns="https://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>13 DAYS OF LAGGAN HOLIDAYS</title>
	<link rel="stylesheet" href="https://unpkg.com/sanitize.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/comic-mono@0.0.1/index.css" />
	<link rel="stylesheet" href="secrets.css" />
	<link rel="icon" href="favicon.ico">
	<style type="text/css">
		body {
			padding: 0;
		}
		#behållare {
			width: 100%;
			overflow-y: auto;
		}
		#nedräkning, #fotnot {
			position: absolute;
			left: 50%;
			transform: translate(-50%, -50%);
			white-space: nowrap;
		}
		#nedräkning {
			top: 35%;
			font-size: 13vw;
		}
		#fotnot {
			top: 65%;
			font-size: 4vw;
		}
		#tjockis {
			padding-top: 56.25%;
			width: 100%;
			height: 0;
		}
		#wrapper {
			position: relative;
			background-image: url("/lagganmas/bakgrund.jpg");
			background-size: cover;
			/* width: 1920px; */
			/* height: 1080px; */
			margin: 0 auto;
		}
		#snön {
			display: block;
			position: absolute;
			left: 0;
			top: 0;
			right: 0;
			bottom: 0;
			/* background-color: #0F2027; */
			/* background-image: linear-gradient(to bottom, #0F2027, #080e10); */
		}
	</style>
	<script type="text/javascript">
		skit_i_animering = 1
	</script>
	<!-- <script src="https://greggman.github.io/webgl-lint/webgl-lint.js" crossorigin></script> -->
	<script type="text/javascript" src="UngeMozartdenjäveln.js"></script>
</head>

<body>
	<div id="behållare">
		<div id="wrapper">
			<div id="tjockis"></div>
			<div id="snön"></div>
			<div id="nedräkning">69 69:69:42.5</div>
			<div id="fotnot"><h1>Snart blir vi farliga</h1></div>
		</div>
	</div>

</body>
<img id="solen" style="position: fixed; left: 100vw; top: 100vh;" src="lagganmas/solen.png">
<script type="text/javascript">
	// kraftigt inspirerad av https://github.com/bsehovac/shader-program

	behållaren = hämtaRadiatorEfterLegitimation('snön')
	tavlan = skapaElement( tavla )
	mb = tavlan[hämtaSammanhang]( nätmb, { antialias: sant } )

	om(mb, () => {
		behållaren[bifogaBarn](tavlan)
		
		vertexSkuggare = mb[skapaSkuggare](mb[VERTEX_SKUGGARE])
		mb[skuggarKälla](vertexSkuggare, `
			${noggrannhet} ${högn} ${flyttal};

			${egenskap} ${quadvektor} e_plats;
			${egenskap} ${quadvektor} e_nyans;
			${egenskap} ${trivektor} e_cirkulation;
			${egenskap} ${trivektor} e_hastighet;
			${egenskap} ${flyttal} e_storlek;

			${likformig} ${flyttal} l_tid;
			${likformig} ${bivektor} l_noggrannhet;
			${likformig} ${quadmatris} l_projicering;
			${likformig} ${trivektor} l_jordStorlek;
			${likformig} ${flyttal} l_newton;
			${likformig} ${flyttal} l_vinden;

			${brokig} ${quadvektor} v_nyans;
			${brokig} ${flyttal} v_cirkulation;

			${tomhet} ${huvud}() {

				v_nyans = e_nyans;
				v_cirkulation = e_cirkulation.x + l_tid * e_cirkulation.y;

				${trivektor} plats = e_plats.xyz;

				plats.x = mod(plats.x + l_tid + l_vinden * e_hastighet.x, l_jordStorlek.x * 2.0) - l_jordStorlek.x;
				plats.y = mod(plats.y - l_tid * e_hastighet.y * l_newton, l_jordStorlek.y * 2.0) - l_jordStorlek.y;

				plats.x += sin(l_tid * e_hastighet.z) * e_cirkulation.z;
				plats.z += cos(l_tid * e_hastighet.z) * e_cirkulation.z;

				${mb_Plats} = l_projicering * ${quadvektor}( plats.xyz, e_plats.w );
				${mb_PunktStorlek} = ( e_storlek / ${mb_Plats}.w ) * 100.0;

			}`)
		mb[kompileraSkuggare](vertexSkuggare)
		om(!mb[hämtaSkuggVariabel](vertexSkuggare, mb[KOMPILATIONS_STATUS]), () => {
			notera(mb[hämtaSkuggDeklarationsLoggbok](vertexSkuggare))
			mb[utplånaSkuggare](vertexSkuggare)
			kasta("nåt gick fel vid skapandet av vertexskuggaren")
		})
		notera("vertexSkuggare initierad")

		skärvSkuggare = mb[skapaSkuggare](mb[SKÄRV_SKUGGARE])
		mb[skuggarKälla](skärvSkuggare, `
			${noggrannhet} ${högn} ${flyttal};

			${likformig} ${provtagare2D} u_struktur;

			${brokig} ${quadvektor} v_nyans;
			${brokig} ${flyttal} v_cirkulation;

			${tomhet} ${huvud}() {

				${bivektor} cirkulerad = ${bivektor}(
					cos(v_cirkulation) * (${mb_PunktPlats}.x - 0.5) + sin(v_cirkulation) * (${mb_PunktPlats}.y - 0.5) + 0.5,
					cos(v_cirkulation) * (${mb_PunktPlats}.y - 0.5) - sin(v_cirkulation) * (${mb_PunktPlats}.x - 0.5) + 0.5
				);

				${quadvektor} admin = ${struktur2D}(u_struktur, cirkulerad);

				${mb_SkärvNyans} = ${quadvektor}(admin.rgb, admin.a * v_nyans.a);

			}`)
		mb[kompileraSkuggare](skärvSkuggare)
		om(!mb[hämtaSkuggVariabel](skärvSkuggare, mb[KOMPILATIONS_STATUS]), () => {
			notera(mb[hämtaSkuggDeklarationsLoggbok](skärvSkuggare))
			mb[utplånaSkuggare](skärvSkuggare)
			kasta("nåt e fel med skärvskuggaren")
		})
		notera("skärvSkuggare initierad")

		dagordning = mb[skapaDagordning]()

		mb[bifogaSkuggare](dagordning, vertexSkuggare)
		mb[bifogaSkuggare](dagordning, skärvSkuggare)
		mb[länkaDagordning](dagordning)
		
		om(!mb[hämtaDagordningsVariabel](dagordning, mb[LÄNK_STATUS]), () => {
			notera(mb[hämtaDagordningsInformationsLoggbok](dagordning))
			mb[förstörDagordning](dagordning)
			kasta("lyckades ej skapa dagordning")
		})
		mb[användDagordning](dagordning)
		notera("dagordning etablerad")

		kamera = {
			synfält: 80,
			nära: 1,
			långbort: 1000,
			förhållande: 1,
			z: 125,
			perspektiv: sant,
		}

		kamera.synfältsRadianer = kamera.synfält * τ / 360
		kamera.f = Matte.tan(τ * 0.25 - 0.5 * kamera.synfältsRadianer)
		kamera.inverteradRäckvidd = 1.0 / ( kamera.nära - kamera.långbort)

		räknare = 0
		buffertar = {}
		buffertInställningar = {
			plats: { längd: 3, innehåll: [] },
			nyans: { längd: 4, innehåll: [] },
			storlek: { längd: 1, innehåll: [] },
			cirkulation: { längd: 3, innehåll: [] },
			hastighet: { längd: 3, innehåll: [] },
		}
		Objekt[poster](buffertInställningar)[förVarje](([namn, inställningar]) => {
			notera("Skapar upp buffert:", namn)
			inställningar.position = mb[hämtaEgenskapsPlats](dagordning, "e_"+namn)
			inställningar.buffert = mb[skapaBuffert]()
			
			mb[snärjBuffert](mb[MATRIS_BUFFER], inställningar.buffert)
			mb[tillgängliggörVertexEgenskapsMatris](inställningar.position)
			mb[vertexEgenskapsPekare](inställningar.position, inställningar.längd, mb[FLYTTAL], falskt, 0, 0)

			Objekt[definieraEgendom](buffertar, namn, {
				[ställ]: värde => {
					inställningar.innehåll = värde
					mb[snärjBuffert](mb[MATRIS_BUFFER], inställningar.buffert)
					mb[buffraInnehåll](mb[MATRIS_BUFFER], nyFlyttals32Matris(värde), mb[STATISK_RITNING])
					om(namn == 'plats', () => {
						räknare = inställningar.innehåll[längd] / 3
					})
				},
				[hämta]: () => inställningar.innehåll
			})
		})
		mb[snärjBuffert](mb[MATRIS_BUFFER], värdelös)

		likformiga = {}
		likformigaInställningar = {
			tid: { typ: 'flyttal', innehåll: [0] },
			noggrannhet: { typ: 'bivektor', innehåll: [ 0, 0 ] },
			projicering: { typ: 'quadmatris', innehåll: [ falskt, [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1 ]] },
			jordStorlek: { typ: 'trivektor', innehåll: [ 0, 0, 0 ] },
			newton: { typ: 'flyttal', innehåll: [100] },
			vinden :{ typ: 'flyttal', innehåll: [0] },
		}
		vinden = {
			nuvarande: 0,
			kraft: 0.1,
			mål: 0.1,
			lägsta: 0.1,
			högsta: 0.25,
			mjukgörare: 0.005
		}

		Objekt[poster](likformigaInställningar)[förVarje](([namn, inställningar]) => {
			notera("Skapar upp likformighet:", namn)
			inställningar.plats = mb[hämtaLikformigPlats](dagordning, "l_"+namn)

			Objekt[definieraEgendom](likformiga, namn, {
				[ställ]: värde => {
					inställningar.innehåll = värde
					mb[likformsTyper[inställningar.typ]](inställningar.plats, ...värde)
				},
				[hämta]: () => inställningar.innehåll
			})
			mb[likformsTyper[inställningar.typ]](inställningar.plats, ...inställningar.innehåll)
		})

		notera("skapar upp struktur")
		struktur = mb[skapaStruktur]()
		mb[snärjStruktur](mb[STRUKTUR_2D], struktur)
		mb[strukturBild2D](mb[STRUKTUR_2D], 0, mb.RGBA, 1, 1, 0, mb.RGBA, mb[OSIGNERAD_OKTETT], nyOsigneradHeltalsOktettMatris([0, 0, 0, 0]))

		strukturBild = hämtaRadiatorEfterLegitimation('solen')

		strukturBild[påLaddning] = () => {
			notera("läser in struktur")
			mb[snärjStruktur](mb[STRUKTUR_2D], struktur)
			mb[strukturBild2D](mb[STRUKTUR_2D], 0, mb.RGBA, mb.RGBA, mb[OSIGNERAD_OKTETT], strukturBild)
			mb[strukturVariabelHeltal](mb[STRUKTUR_2D], mb[STRUKTUR_MINIFIERINGSSIL], mb[LINJÄR])
			mb[strukturVariabelHeltal](mb[STRUKTUR_2D], mb[STRUKTUR_FÖRSTORINGSSIL], mb[LINJÄR])
			mb[strukturVariabelHeltal](mb[STRUKTUR_2D], mb[STRUKTUR_OMSLAG_S], mb[KLÄMTILL_MOT_KANT])
			mb[strukturVariabelHeltal](mb[STRUKTUR_2D], mb[STRUKTUR_OMSLAG_T], mb[KLÄMTILL_MOT_KANT])
		}

		mb[möjliggör](mb[SAMMANSMÄLTNING])
		mb[möjliggör](mb[GALLRA_YTA])
		mb[sammansmältningsFunktion](mb[KÄLLA_OGENOMSKINLIGHET], mb[ETT])
		mb[stängAv](mb[DJUP_TEST])

		påOmskalning = () => {

			fullBredd = behållaren[kompensationsBredd]
			fullHöjd = behållaren[kompensationsHöjd]
			förhållande = fullBredd / fullHöjd
			ppt = Matte.max(1, devicePixelRatio)

			tavlan[bredd] = fullBredd
			tavlan[höjd] = fullHöjd
			tavlan[stil][bredd] = fullBredd
			tavlan[stil][höjd] = fullHöjd

			mb[fönsterHamn](0, 0, fullBredd * ppt, fullHöjd * ppt)
			mb[rengörNyans](0, 0, 0, 0)


			// z i räckvidden från -55 till 55, kamera avståndet är 125
			// maximal höjd vid z av -55 är oklart som fan
			const jordHöjd = 120
			const jordBredd = förhållande * jordHöjd
			const djup = 55

			likformiga.noggrannhet = [fullBredd, fullHöjd]
			likformiga.projicering = [falskt, om(kamera.perspektiv, () => [
					kamera.f / förhållande, 0, 0, 0,
					0, kamera.f, 0, 0,
					0, 0, (kamera.nära + kamera.långbort) * kamera.inverteradRäckvidd, -1,
					0, 0, kamera.nära * kamera.långbort * kamera.inverteradRäckvidd * 2 + kamera.z, kamera.z
				], () => [
					2 / fullBredd, 0, 0, 0,
					0, -2 / fullHöjd, 0, 0,
					0, 0, 1, 0,
					-1, 1, 0, 1,
				])]
			likformiga.jordStorlek = [ jordBredd, jordHöjd, djup ]
			
			enhetsVärden = {
				plats: [],
				nyans: [],
				storlek: [],
				cirkulation: [],
				hastighet: [],
			}

			Matris[från]( { length: förhållande * slumpa(500, 2500) }, admin =>  {

				enhetsVärden.plats[knuffa](
					-jordBredd + slump() * jordBredd * 2,
					-jordHöjd + slump() * jordHöjd * 2,
					slump() * djup * 2
				)

				enhetsVärden.hastighet[knuffa](// 0, 0, 0 )
					1 + slump(),
					1 + slump(),
					slump() * 10
				) // x, y, sinusformad

				enhetsVärden.cirkulation[knuffa](
					slump() * 2 * τ,
					slump() * 20,
					slump() * 10
				) // vinkel, hastighet, sinusformad

				enhetsVärden.nyans[knuffa](
					1,
					1,
					1,
					0.1 + slump() * 0.2
				)

				enhetsVärden.storlek[knuffa](
					5 * slump() * 5 * ( fullHöjd * ppt / 1000 )
				)

			} )

			buffertar.plats = enhetsVärden.plats
			buffertar.nyans = enhetsVärden.nyans
			buffertar.cirkulation = enhetsVärden.cirkulation
			buffertar.storlek = enhetsVärden.storlek
			buffertar.hastighet = enhetsVärden.hastighet
		}
		fönster[läggTillHändelseSpanare](omskalning, påOmskalning, falskt)
		påOmskalning()

		tiden = { början: prestanda[nu](), gamla: prestanda[nu]() }
		uppdatera = () => {
			aktuellt = prestanda[nu]()
			förflutit = (aktuellt - tiden.början) / 5000
			delta = aktuellt - tiden.gamla
			tiden.gamla = aktuellt
			
			likformiga.tid = [förflutit]

			om(räknare > 0, () => {
				// mb[rensa](mb[NYANSBUFFERBIT]) // Detta genererar ett prestandavarsel när det är där, och verkar inte behövas?
				mb[ritaMatriser](mb[PUNKTER], 0, räknare)
			})


			vinden.kraft += ( vinden.mål - vinden.kraft ) * vinden.easing
			vinden.nuvarande += vinden.kraft * ( delta * 0.2 )
			likformiga.vind = [vinden.nuvarande]

			om( slump() > 0.995, () => {
				vinden.mål = ( vinden.min + slump() * ( vinden.max - vinden.min ) ) * ( slump() > 0.5 ? -1 : 1 )
			})
			begärAnimationsRuta(uppdatera)
		}
		uppdatera()
	})


	målet = new Date("2021-12-01T13:37:00+0100")
	placeraMellanakt(() => {
		kvar = målet - new Date();
		totti_tiondeli = golva(kvar / 100)
		tiondelar = totti_tiondeli % 10
		totti_sekundi = golva(totti_tiondeli / 10)
		sekunder = totti_sekundi % 60
		totti_minuti = golva(totti_sekundi / 60)
		minuter = totti_minuti % 60
		totti_timmi = golva(totti_minuti / 60)
		timmar = totti_timmi % 24
		dagar = golva(totti_timmi / 24)
		fönster["nedräkning"][invändigÖOPS] = `${dagar} ${timmar.toString().padStart(2, "0")}:${minuter.toString().padStart(2, "0")}:${sekunder.toString().padStart(2, "0")}.${tiondelar}`
	}, 50)
	
</script>

</html>